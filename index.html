<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Antikythera Mechanism - Multi-Dial Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #f0e6d2;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #d4af37;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .subtitle {
            text-align: center;
            font-size: 1.2em;
            margin-bottom: 30px;
            color: #c4b5a0;
            font-style: italic;
        }

        .main-display {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            align-items: start;
        }

        @media (max-width: 1200px) {
            .main-display {
                grid-template-columns: 1fr;
            }
        }

        .dial-panel {
            background: rgba(15, 32, 39, 0.9);
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .dial-panel h3 {
            color: #d4af37;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.3em;
            border-bottom: 2px solid rgba(212, 175, 55, 0.3);
            padding-bottom: 10px;
        }

        canvas {
            display: block;
            margin: 0 auto;
            background: radial-gradient(circle, #1a1a2e 0%, #0f0f1e 100%);
            border: 2px solid #d4af37;
            border-radius: 8px;
            box-shadow: inset 0 0 20px rgba(212, 175, 55, 0.2);
            cursor: grab;
        }

        canvas:active {
            cursor: grabbing;
        }

        .center-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        button {
            background: linear-gradient(135deg, #d4af37 0%, #b8941f 100%);
            border: none;
            color: #0f2027;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(212, 175, 55, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .readout {
            background: rgba(0,0,0,0.4);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #d4af37;
        }

        .readout-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid rgba(212, 175, 55, 0.3);
        }

        .readout-item:last-child {
            border-bottom: none;
        }

        .label {
            color: #d4af37;
            font-weight: bold;
        }

        .value {
            color: #f0e6d2;
        }

        .instruction {
            text-align: center;
            color: #d4af37;
            font-style: italic;
            margin: 15px 0;
            font-size: 1.1em;
        }

        .highlight-box {
            background: rgba(212, 175, 55, 0.15);
            border: 2px solid #d4af37;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .highlight-box h4 {
            color: #d4af37;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .highlight-box p {
            color: #c4b5a0;
            line-height: 1.6;
        }

        .dial-reading {
            text-align: center;
            margin-top: 10px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            font-size: 0.9em;
        }

        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(212, 175, 55, 0.9);
            color: #0f2027;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            z-index: 1000;
        }

        .sync-indicator.active {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="sync-indicator" id="syncIndicator">ALL DIALS SYNCHRONIZED ‚úì</div>
    
    <div class="container">
        <h1>The Antikythera Mechanism</h1>
        <p class="subtitle">One Crank. Infinite Cosmos. Simultaneous Reading.</p>

        <div class="highlight-box">
            <h4>The Revolutionary Concept:</h4>
            <p>By turning a single hand crank, all dials update simultaneously‚Äîshowing solar position, lunar phase, planetary locations, eclipse predictions, and calendar dates all at once. This is what made the Mechanism extraordinary: the entire cosmos synchronized in your hands.</p>
        </div>

        <div class="main-display">
            <!-- Left Panel: Eclipse & Calendar Dials -->
            <div class="dial-panel">
                <h3>REAR FACE<br/>Eclipse & Calendar Dials</h3>
                <canvas id="eclipseCanvas" width="300" height="300"></canvas>
                <div class="dial-reading">
                    <div class="readout-item">
                        <span class="label">Saros Cycle:</span>
                        <span class="value" id="sarosReading">Month 0/223</span>
                    </div>
                    <div class="readout-item">
                        <span class="label">Next Eclipse:</span>
                        <span class="value" id="eclipseReading">None predicted</span>
                    </div>
                    <div class="readout-item">
                        <span class="label">Metonic Year:</span>
                        <span class="value" id="metonicReading">1/19</span>
                    </div>
                </div>
            </div>

            <!-- Center Panel: Main Zodiac Dial -->
            <div class="center-panel">
                <div class="dial-panel">
                    <h3>FRONT FACE<br/>Main Zodiac & Calendar Dial</h3>
                    <p class="instruction">üñ±Ô∏è Drag the crank or use controls below</p>
                    <canvas id="mainCanvas" width="600" height="600"></canvas>
                    
                    <div class="controls">
                        <button id="turnCrank">Turn Crank ‚Üª</button>
                        <button id="fastForward">Fast Forward ‚è©</button>
                        <button id="reset">Reset</button>
                        <button id="autoRotate">Auto Rotate</button>
                    </div>

                    <div class="readout">
                        <div class="readout-item">
                            <span class="label">Days Elapsed:</span>
                            <span class="value" id="daysElapsed">0</span>
                        </div>
                        <div class="readout-item">
                            <span class="label">Solar Position:</span>
                            <span class="value" id="solarPos">Aries 0¬∞</span>
                        </div>
                        <div class="readout-item">
                            <span class="label">Lunar Position:</span>
                            <span class="value" id="lunarPos">Aries 0¬∞</span>
                        </div>
                        <div class="readout-item">
                            <span class="label">Moon Phase:</span>
                            <span class="value" id="moonPhase">New Moon</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Planetary Positions -->
            <div class="dial-panel">
                <h3>FRONT FACE<br/>Planetary Position Dial</h3>
                <canvas id="planetCanvas" width="300" height="300"></canvas>
                <div class="dial-reading">
                    <div class="readout-item">
                        <span class="label">Mercury:</span>
                        <span class="value" id="mercuryPos">Aries</span>
                    </div>
                    <div class="readout-item">
                        <span class="label">Venus:</span>
                        <span class="value" id="venusPos">Aries</span>
                    </div>
                    <div class="readout-item">
                        <span class="label">Mars:</span>
                        <span class="value" id="marsPos">Aries</span>
                    </div>
                    <div class="readout-item">
                        <span class="label">Jupiter:</span>
                        <span class="value" id="jupiterPos">Aries</span>
                    </div>
                    <div class="readout-item">
                        <span class="label">Saturn:</span>
                        <span class="value" id="saturnPos">Aries</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="highlight-box">
            <h4>Understanding the Simultaneity:</h4>
            <p>Watch how turning the crank creates a cascade of synchronized movements across all three dial systems. The main dial shows the sun and moon, the eclipse dial counts toward the next eclipse using the Saros cycle, and the planetary dial tracks all five visible planets. Ancient users could instantly read the entire state of the cosmos from a single glance‚Äîpast, present, and future encoded in bronze.</p>
        </div>
    </div>

    <script>
        // Get canvas contexts
        const mainCanvas = document.getElementById('mainCanvas');
        const mainCtx = mainCanvas.getContext('2d');
        const eclipseCanvas = document.getElementById('eclipseCanvas');
        const eclipseCtx = eclipseCanvas.getContext('2d');
        const planetCanvas = document.getElementById('planetCanvas');
        const planetCtx = planetCanvas.getContext('2d');

        // State variables
        let rotation = 0;
        let daysElapsed = 0;
        let autoRotating = false;
        let isDragging = false;
        let lastMouseX = 0;

        const zodiacSigns = ['Aries', 'Taurus', 'Gemini', 'Cancer', 'Leo', 'Virgo', 
                             'Libra', 'Scorpio', 'Sagittarius', 'Capricorn', 'Aquarius', 'Pisces'];
        const moonPhases = ['New Moon', 'Waxing Crescent', 'First Quarter', 'Waxing Gibbous', 
                           'Full Moon', 'Waning Gibbous', 'Last Quarter', 'Waning Crescent'];

        // Planetary orbital periods (relative to Earth years)
        const planetSpeeds = {
            mercury: 0.241,
            venus: 0.615,
            mars: 1.881,
            jupiter: 11.862,
            saturn: 29.457
        };

        function showSyncIndicator() {
            const indicator = document.getElementById('syncIndicator');
            indicator.classList.add('active');
            setTimeout(() => indicator.classList.remove('active'), 1000);
        }

        function drawGear(ctx, x, y, radius, teeth, rotation, color) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotation);

            // Gear body
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(0, 0, radius * 0.7, 0, Math.PI * 2);
            ctx.fill();

            // Gear teeth
            for (let i = 0; i < teeth; i++) {
                const angle = (i / teeth) * Math.PI * 2;
                ctx.save();
                ctx.rotate(angle);
                ctx.fillRect(-radius * 0.1, radius * 0.7, radius * 0.2, radius * 0.3);
                ctx.restore();
            }

            // Center hole
            ctx.fillStyle = '#0f0f1e';
            ctx.beginPath();
            ctx.arc(0, 0, radius * 0.3, 0, Math.PI * 2);
            ctx.fill();

            ctx.restore();
        }

        function drawPointer(ctx, cx, cy, angle, length, color, label) {
            ctx.save();
            ctx.translate(cx, cy);
            ctx.rotate(angle - Math.PI / 2);
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.lineTo(length, 0);
            ctx.stroke();

            // Arrowhead
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.moveTo(length, 0);
            ctx.lineTo(length - 10, -5);
            ctx.lineTo(length - 10, 5);
            ctx.fill();

            if (label) {
                ctx.fillStyle = color;
                ctx.font = 'bold 12px Georgia';
                ctx.textAlign = 'center';
                ctx.fillText(label, length / 2, -10);
            }

            ctx.restore();
        }

        function drawMoonPhase(ctx, x, y, phaseAngle) {
            const radius = 20;
            
            // Full moon circle
            ctx.fillStyle = '#87ceeb';
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.fill();

            // Shadow for phase
            const illumination = (Math.cos(phaseAngle) + 1) / 2;
            
            ctx.fillStyle = '#1a1a2e';
            ctx.beginPath();
            if (illumination < 0.5) {
                ctx.arc(x, y, radius, -Math.PI / 2, Math.PI / 2, false);
                ctx.ellipse(x, y, radius * (1 - illumination * 2), radius, 0, Math.PI / 2, -Math.PI / 2, true);
            } else {
                ctx.arc(x, y, radius, Math.PI / 2, -Math.PI / 2, false);
                ctx.ellipse(x, y, radius * ((illumination - 0.5) * 2), radius, 0, -Math.PI / 2, Math.PI / 2, true);
            }
            ctx.fill();
        }

        // MAIN DIAL - Zodiac with Sun and Moon
        function drawMainDial() {
            const centerX = mainCanvas.width / 2;
            const centerY = mainCanvas.height / 2;
            
            mainCtx.fillStyle = '#0f0f1e';
            mainCtx.fillRect(0, 0, mainCanvas.width, mainCanvas.height);

            // Outer zodiac ring
            const zodiacRadius = 240;
            mainCtx.strokeStyle = '#d4af37';
            mainCtx.lineWidth = 3;
            mainCtx.beginPath();
            mainCtx.arc(centerX, centerY, zodiacRadius, 0, Math.PI * 2);
            mainCtx.stroke();

            // Zodiac labels
            mainCtx.font = '16px Georgia';
            mainCtx.fillStyle = '#d4af37';
            mainCtx.textAlign = 'center';
            mainCtx.textBaseline = 'middle';

            for (let i = 0; i < 12; i++) {
                const angle = (i / 12) * Math.PI * 2 - Math.PI / 2;
                const x = centerX + Math.cos(angle) * (zodiacRadius + 30);
                const y = centerY + Math.sin(angle) * (zodiacRadius + 30);
                mainCtx.fillText(zodiacSigns[i], x, y);
            }

            // Calendar ring
            mainCtx.strokeStyle = '#c4b5a0';
            mainCtx.lineWidth = 2;
            mainCtx.beginPath();
            mainCtx.arc(centerX, centerY, 200, 0, Math.PI * 2);
            mainCtx.stroke();

            // Day markers (365 days)
            for (let i = 0; i < 365; i += 5) {
                const angle = (i / 365) * Math.PI * 2 - Math.PI / 2;
                const x1 = centerX + Math.cos(angle) * 195;
                const y1 = centerY + Math.sin(angle) * 195;
                const x2 = centerX + Math.cos(angle) * 205;
                const y2 = centerY + Math.sin(angle) * 205;
                
                mainCtx.strokeStyle = i % 30 === 0 ? '#d4af37' : '#555';
                mainCtx.lineWidth = i % 30 === 0 ? 2 : 1;
                mainCtx.beginPath();
                mainCtx.moveTo(x1, y1);
                mainCtx.lineTo(x2, y2);
                mainCtx.stroke();
            }

            // Central mechanism gears
            drawGear(mainCtx, centerX, centerY, 50, 30, rotation * 2, '#d4af37');
            drawGear(mainCtx, centerX - 70, centerY - 70, 30, 20, -rotation * 3, '#c4b5a0');
            drawGear(mainCtx, centerX + 70, centerY - 70, 28, 18, rotation * 4, '#b8941f');

            // Sun pointer
            drawPointer(mainCtx, centerX, centerY, rotation, 180, '#ff6b6b', 'SUN');

            // Moon pointer
            drawPointer(mainCtx, centerX, centerY, rotation * 12.37, 150, '#87ceeb', 'MOON');

            // Moon phase display
            const moonPhaseAngle = (rotation * 12.37) % (Math.PI * 2);
            drawMoonPhase(mainCtx, centerX + 100, centerY - 180, moonPhaseAngle);

            // Crank handle
            const crankX = centerX + 220;
            const crankY = centerY;
            mainCtx.strokeStyle = '#d4af37';
            mainCtx.lineWidth = 4;
            mainCtx.beginPath();
            mainCtx.moveTo(centerX + 50, centerY);
            mainCtx.lineTo(crankX - 30, crankY);
            mainCtx.stroke();

            mainCtx.save();
            mainCtx.translate(crankX, crankY);
            mainCtx.rotate(rotation * 2);
            
            mainCtx.fillStyle = '#d4af37';
            mainCtx.fillRect(-10, -30, 20, 60);
            
            mainCtx.beginPath();
            mainCtx.arc(0, -30, 8, 0, Math.PI * 2);
            mainCtx.fill();
            mainCtx.beginPath();
            mainCtx.arc(0, 30, 8, 0, Math.PI * 2);
            mainCtx.fill();
            
            mainCtx.restore();
        }

        // ECLIPSE DIAL - Saros and Metonic cycles
        function drawEclipseDial() {
            const centerX = eclipseCanvas.width / 2;
            const centerY = eclipseCanvas.height / 2;
            
            eclipseCtx.fillStyle = '#0f0f1e';
            eclipseCtx.fillRect(0, 0, eclipseCanvas.width, eclipseCanvas.height);

            // Saros cycle (223 months)
            const sarosRadius = 110;
            eclipseCtx.strokeStyle = '#d4af37';
            eclipseCtx.lineWidth = 3;
            eclipseCtx.beginPath();
            eclipseCtx.arc(centerX, centerY, sarosRadius, 0, Math.PI * 2);
            eclipseCtx.stroke();

            // Saros markers
            for (let i = 0; i < 223; i += 10) {
                const angle = (i / 223) * Math.PI * 2 - Math.PI / 2;
                const x1 = centerX + Math.cos(angle) * (sarosRadius - 5);
                const y1 = centerY + Math.sin(angle) * (sarosRadius - 5);
                const x2 = centerX + Math.cos(angle) * (sarosRadius + 5);
                const y2 = centerY + Math.sin(angle) * (sarosRadius + 5);
                
                eclipseCtx.strokeStyle = '#d4af37';
                eclipseCtx.lineWidth = 2;
                eclipseCtx.beginPath();
                eclipseCtx.moveTo(x1, y1);
                eclipseCtx.lineTo(x2, y2);
                eclipseCtx.stroke();
            }

            // Saros pointer
            const sarosAngle = (daysElapsed / 29.53 / 223) * Math.PI * 2;
            drawPointer(eclipseCtx, centerX, centerY, sarosAngle, sarosRadius - 10, '#ff6b6b', '');

            // Metonic cycle (19 years) - inner ring
            const metonicRadius = 60;
            eclipseCtx.strokeStyle = '#87ceeb';
            eclipseCtx.lineWidth = 2;
            eclipseCtx.beginPath();
            eclipseCtx.arc(centerX, centerY, metonicRadius, 0, Math.PI * 2);
            eclipseCtx.stroke();

            // Metonic markers
            for (let i = 0; i < 19; i++) {
                const angle = (i / 19) * Math.PI * 2 - Math.PI / 2;
                const x = centerX + Math.cos(angle) * metonicRadius;
                const y = centerY + Math.sin(angle) * metonicRadius;
                
                eclipseCtx.fillStyle = '#87ceeb';
                eclipseCtx.beginPath();
                eclipseCtx.arc(x, y, 3, 0, Math.PI * 2);
                eclipseCtx.fill();
            }

            // Metonic pointer
            const metonicAngle = (daysElapsed / 365.25 / 19) * Math.PI * 2;
            drawPointer(eclipseCtx, centerX, centerY, metonicAngle, metonicRadius - 10, '#87ceeb', '');

            // Labels
            eclipseCtx.font = 'bold 14px Georgia';
            eclipseCtx.fillStyle = '#d4af37';
            eclipseCtx.textAlign = 'center';
            eclipseCtx.fillText('SAROS', centerX, 30);
            eclipseCtx.fillStyle = '#87ceeb';
            eclipseCtx.fillText('METONIC', centerX, centerY);
        }

        // PLANETARY DIAL
        function drawPlanetaryDial() {
            const centerX = planetCanvas.width / 2;
            const centerY = planetCanvas.height / 2;
            
            planetCtx.fillStyle = '#0f0f1e';
            planetCtx.fillRect(0, 0, planetCanvas.width, planetCanvas.height);

            // Zodiac ring
            const zodiacRadius = 110;
            planetCtx.strokeStyle = '#d4af37';
            planetCtx.lineWidth = 2;
            planetCtx.beginPath();
            planetCtx.arc(centerX, centerY, zodiacRadius, 0, Math.PI * 2);
            planetCtx.stroke();

            // Zodiac segments
            for (let i = 0; i < 12; i++) {
                const angle = (i / 12) * Math.PI * 2 - Math.PI / 2;
                const x1 = centerX + Math.cos(angle) * (zodiacRadius - 5);
                const y1 = centerY + Math.sin(angle) * (zodiacRadius - 5);
                const x2 = centerX + Math.cos(angle) * (zodiacRadius + 5);
                const y2 = centerY + Math.sin(angle) * (zodiacRadius + 5);
                
                planetCtx.strokeStyle = '#d4af37';
                planetCtx.lineWidth = 2;
                planetCtx.beginPath();
                planetCtx.moveTo(x1, y1);
                planetCtx.lineTo(x2, y2);
                planetCtx.stroke();
            }

            // Planet positions
            const planets = [
                { name: 'Me', speed: 1 / planetSpeeds.mercury, radius: 50, color: '#999' },
                { name: 'V', speed: 1 / planetSpeeds.venus, radius: 60, color: '#ffcc99' },
                { name: 'Ma', speed: 1 / planetSpeeds.mars, radius: 70, color: '#ff6b6b' },
                { name: 'J', speed: 1 / planetSpeeds.jupiter, radius: 85, color: '#ffaa55' },
                { name: 'S', speed: 1 / planetSpeeds.saturn, radius: 100, color: '#ccaa77' }
            ];

            planets.forEach(planet => {
                const angle = rotation * planet.speed - Math.PI / 2;
                const x = centerX + Math.cos(angle) * planet.radius;
                const y = centerY + Math.sin(angle) * planet.radius;
                
                planetCtx.fillStyle = planet.color;
                planetCtx.beginPath();
                planetCtx.arc(x, y, 6, 0, Math.PI * 2);
                planetCtx.fill();
                
                planetCtx.fillStyle = '#f0e6d2';
                planetCtx.font = 'bold 10px Georgia';
                planetCtx.textAlign = 'center';
                planetCtx.textBaseline = 'middle';
                planetCtx.fillText(planet.name, x, y);
            });

            // Central gear
            drawGear(planetCtx, centerX, centerY, 30, 20, rotation * 3, '#d4af37');
        }

        function updateReadouts() {
            const solarDegree = ((rotation * 180 / Math.PI) % 360 + 360) % 360;
            const solarSign = zodiacSigns[Math.floor(solarDegree / 30)];
            const solarDegInSign = Math.floor(solarDegree % 30);
            
            const lunarDegree = ((rotation * 12.37 * 180 / Math.PI) % 360 + 360) % 360;
            const lunarSign = zodiacSigns[Math.floor(lunarDegree / 30)];
            const lunarDegInSign = Math.floor(lunarDegree % 30);
            
            const phaseIndex = Math.floor(((rotation * 12.37) % (Math.PI * 2) + Math.PI * 2) % (Math.PI * 2) / (Math.PI / 4));
            
            const sarosMonth = Math.floor((daysElapsed / 29.53) % 223);
            const metonicYear = Math.floor((daysElapsed / 365.25) % 19) + 1;
            
            const nearEclipse = sarosMonth % 6 === 0;
            
            document.getElementById('solarPos').textContent = `${solarSign} ${solarDegInSign}¬∞`;
            document.getElementById('lunarPos').textContent = `${lunarSign} ${lunarDegInSign}¬∞`;
            document.getElementById('moonPhase').textContent = moonPhases[phaseIndex];
            document.getElementById('daysElapsed').textContent = daysElapsed;
            
            document.getElementById('sarosReading').textContent = `Month ${sarosMonth}/223`;
            document.getElementById('eclipseReading').textContent = nearEclipse ? 'ECLIPSE NEAR!' : `${6 - (sarosMonth % 6)} months away`;
            document.getElementById('metonicReading').textContent = `Year ${metonicYear}/19`;
            
            // Update planetary positions
            const planets = ['mercury', 'venus', 'mars', 'jupiter', 'saturn'];
            planets.forEach(planet => {
                const planetDeg = ((rotation / planetSpeeds[planet] * 180 / Math.PI) % 360 + 360) % 360;
                const planetSign = zodiacSigns[Math.floor(planetDeg / 30)];
                document.getElementById(`${planet}Pos`).textContent = planetSign;
            });
        }

        function draw() {
            drawMainDial();
            drawEclipseDial();
            drawPlanetaryDial();
        }

        function animate() {
            if (autoRotating) {
                rotation += 0.01;
                daysElapsed += 1;
                updateReadouts();
            }
            draw();
            requestAnimationFrame(animate);
        }

        // Mouse interaction for dragging
        mainCanvas.addEventListener('mousedown', (e) => {
            isDragging = true;
            lastMouseX = e.clientX;
        });

        mainCanvas.addEventListener('mousemove', (e) => {
            if (isDragging) {
                const deltaX = e.clientX - lastMouseX;
                rotation += deltaX * 0.01;
                daysElapsed += Math.abs(Math.floor(deltaX));
                lastMouseX = e.clientX;
                updateReadouts();
                showSyncIndicator();
            }
        });

        mainCanvas.addEventListener('mouseup', () => {
            isDragging = false;
        });

        mainCanvas.addEventListener('mouseleave', () => {
            isDragging = false;
        });

        // Touch support for mobile
        mainCanvas.addEventListener('touchstart', (e) => {
            isDragging = true;
            lastMouseX = e.touches[0].clientX;
            e.preventDefault();
        });

        mainCanvas.addEventListener('touchmove', (e) => {
            if (isDragging) {
                const deltaX = e.touches[0].clientX - lastMouseX;
                rotation += deltaX * 0.01;
                daysElapsed += Math.abs(Math.floor(deltaX));
                lastMouseX = e.touches[0].clientX;
                updateReadouts();
                showSyncIndicator();
                e.preventDefault();
            }
        });

        mainCanvas.addEventListener('touchend', () => {
            isDragging = false;
        });

        // Button controls
        document.getElementById('turnCrank').addEventListener('click', () => {
            rotation += Math.PI / 6;
            daysElapsed += 30;
            updateReadouts();
            showSyncIndicator();
        });

        document.getElementById('fastForward').addEventListener('click', () => {
            rotation += Math.PI;
            daysElapsed += 182;
            updateReadouts();
            showSyncIndicator();
        });

        document.getElementById('reset').addEventListener('click', () => {
            rotation = 0;
            daysElapsed = 0;
            autoRotating = false;
            updateReadouts();
            showSyncIndicator();
        });

        document.getElementById('autoRotate').addEventListener('click', () => {
            autoRotating = !autoRotating;
            if (autoRotating) {
                showSyncIndicator();
            }
        });

        // Initialize
        updateReadouts();
        animate();
    </script>
</body>
</html>